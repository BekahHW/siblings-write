---
import PostHogLayout from '../layouts/PostHogLayout.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection, getEntry } from 'astro:content';

// Get all works and sort by order
const allWorks = await getCollection('works');
const sortedWorks = allWorks.sort((a, b) => a.data.order - b.data.order);
const featuredWorks = sortedWorks.filter(work => work.data.featured);
const otherWorks = sortedWorks.filter(work => !work.data.featured);

// Get page settings
const worksSettings = await getEntry('pages', 'works');

const title = worksSettings?.data.title || 'Our Work';
const description = 'Discover our projects and stories.';
const permalink = `${Astro.site.href}work`;
const intro = worksSettings?.data.intro || "We're passionate about creating adventurous stories, that spark your imagination and bring joy to our readers. Here's a look at some of the work we've done and what we're currently working on.";
const featuredTitle = worksSettings?.data.featuredTitle || 'Featured Work';
const otherProjectsTitle = worksSettings?.data.otherProjectsTitle || 'Other Projects';
---

<PostHogLayout>
  <BaseLayout title={title} description={description} permalink={permalink} current="work">
    <div class="container-new">
      <h1>{title}</h1>
      <p>{intro}</p>

      <!-- Featured Works Section -->
      {featuredWorks.length > 0 && (
        <>
          <h2>{featuredTitle}</h2>
          {featuredWorks.map((work) => (
            <div class="book-section">
              <img src={work.data.image} alt={work.data.title} width="200">
              <div>
                <p><strong>{work.data.title}</strong><br/>{work.data.description}</p>
                <a href={work.data.link} target="_blank" rel="noopener" class="buy-button">Buy Now on Amazon</a>
              </div>
            </div>
          ))}
        </>
      )}

      <!-- Other Projects Section -->
      {otherWorks.length > 0 && (
        <>
          <h2>{otherProjectsTitle}</h2>
          <ul>
            {otherWorks.map((work) => (
              <li>
                <strong><a href={work.data.link} target="_blank" rel="noopener">{work.data.title}</a></strong>
                <em> {work.data.description}</em>
              </li>
            ))}
          </ul>
        </>
      )}
    </div>
  </BaseLayout>
</PostHogLayout>

<style>
  .container-new {
    max-width: 80%;
    margin: 0 auto;
    padding: 2em;
  }

  .work-image {
    float: right;
    margin: -3em -7em 2em 2em;
    max-width: 300px;
  }

  .work-image img {
    border-radius: 8px;
    margin-bottom: 1.5em;
  }

  .book-section {
    display: flex;
    align-items: center;
    gap: 1em;
    margin: 2em 0;
  }

  .book-section img {
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: 12px
  }

  .buy-button {
    display: inline-block;
    margin-top: 1em;
    padding: 0.8em 1.5em;
    background-color: #007acc;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-weight: bold;
  }

  .buy-button:hover {
    background-color: #005fa3;
  }

  @media (max-width: 1020px) {
    .work-image {
      float: none;
      margin: 0 auto 2em;
    }

    .book-section {
      flex-direction: column;
      align-items: flex-start;
    }

    .book-section img {
      width: 100%;
      max-width: 250px;
    }
  }
</style>