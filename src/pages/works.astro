---
import PostHogLayout from '../layouts/PostHogLayout.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection, getEntry } from 'astro:content';

// Get all works and sort by order
const allWorks = await getCollection('works');
const sortedWorks = allWorks.sort((a, b) => a.data.order - b.data.order);
const featuredWorks = sortedWorks.filter(work => work.data.featured);
const otherWorks = sortedWorks.filter(work => !work.data.featured);

// Get page settings
const worksSettings = await getEntry('pages', 'works');

const title = worksSettings?.data.title || 'Our Work';
const description = worksSettings?.data.description || 'Discover our young adult fiction, middle grade adventures, and Christmas novels. Browse YA fiction like Escape from Browns Island, holiday stories like The Battle for Christmas, and middle grade adventures by the Hawrot siblings.';
const permalink = `${Astro.site.href}work`;
const intro = worksSettings?.data.intro || "We're passionate about creating adventurous stories, that spark your imagination and bring joy to our readers. Here's a look at some of the work we've done and what we're currently working on.";
const featuredTitle = worksSettings?.data.featuredTitle || 'Featured Work';
const otherProjectsTitle = worksSettings?.data.otherProjectsTitle || 'Other Projects';

// Generate structured data for all works
const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "@id": "https://www.siblingswrite.com/works#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://www.siblingswrite.com/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Our Work",
          "item": "https://www.siblingswrite.com/works"
        }
      ]
    },
    ...featuredWorks.map(work => ({
      "@type": "Book",
      "@id": `https://www.siblingswrite.com/work#${work.id}`,
      "name": work.data.title,
      "description": work.data.description,
      "image": `https://www.siblingswrite.com${work.data.image}`,
      "url": work.data.link,
      "inLanguage": "en-US"
    }))
  ]
};
---

<PostHogLayout>
  <BaseLayout title={title} description={description} permalink={permalink} current="work">
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
    <div class="container-new">
      <h1>{title}</h1>
      <p>{intro}</p>

      <!-- Featured Works Section -->
      {featuredWorks.length > 0 && (
        <>
          <h2>{featuredTitle}</h2>
          {featuredWorks.map((work) => (
            <article class="book-section" itemscope itemtype="https://schema.org/Book">
              <a href={`/works/${work.id}`} class="book-cover-link">
                <img
                  src={work.data.image}
                  alt={`Book cover for ${work.data.title}`}
                  width="200"
                  itemprop="image"
                  loading="lazy"
                >
              </a>
              <div>
                <p>
                  <strong itemprop="name">
                    <a href={`/works/${work.id}`} class="work-title-link">{work.data.title}</a>
                  </strong><br/>
                  <span itemprop="description">{work.data.description}</span>
                </p>
                <div class="button-group">
                  <a
                    href={`/works/${work.id}`}
                    class="learn-more-button"
                  >
                    Learn More
                  </a>
                  <a
                    href={work.data.link}
                    target="_blank"
                    rel="noopener"
                    class="buy-button"
                    itemprop="url"
                  >
                    Buy Now on Amazon
                  </a>
                </div>
              </div>
            </article>
          ))}
        </>
      )}

      <!-- Reader Testimonials -->
      <h2>What Readers Are Saying</h2>
      <div class="testimonials-section">
        <blockquote class="testimonial">
          <p>"Great story. I love the descriptions of the store and the people. It was heart warming.♥️"</p>
          <cite>— Reader of our Short Stories</cite>
        </blockquote>

        <blockquote class="testimonial">
          <p>"Escape from Brown's Island bursts off the page like a star running back on a Saturday-night breakaway—fast, thrilling, and impossible to stop. The Hawrot siblings cut, juke, and power through danger with the perfect mix of grit and finesse, turning every chapter into a game-winning drive. A true end-zone celebration of adventure worthy of the record books."</p>
          <cite>— Reader of Escape from Brown's Island</cite>
        </blockquote>

        <blockquote class="testimonial">
          <p>"I decided to give this book a try over the holiday season and I'm so glad I did! This was a huge break from the normal self-help / non-fiction books I like to read, so I wasn't sure what to expect. The authors do a wonderful job of building a world based on their own lives while pushing into fantasy and adventure in so many creative ways! I couldn't put the book down after the halfway point where the story keeps you guessing while filling you with an undeniable Christmas cheer. I'm a grown adult who felt like a kid again while enjoying this story. I've since passed it along to my own son with the same joy shared by the characters in this book! I hope you enjoy it as much as we do!"</p>
          <cite>— Reader of Battle for Christmas: Reign of the Nutcrackers</cite>
        </blockquote>
      </div>
    </div>
  </BaseLayout>
</PostHogLayout>

<style>
  .container-new {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2em;
  }

  .work-image {
    float: right;
    margin: -3em -7em 2em 2em;
    max-width: 300px;
  }

  .work-image img {
    border-radius: 8px;
    margin-bottom: 1.5em;
  }

  .book-section {
    display: flex;
    align-items: center;
    gap: 2em;
    margin: 3em 0;
    padding: 2em;
    background: linear-gradient(135deg, rgba(249, 168, 212, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
    border-radius: 20px;
    transition: all 0.4s ease;
    border: 2px solid rgba(124, 58, 237, 0.1);
  }

  .book-section > div {
    flex: 1;
    min-width: 0;
  }

  .book-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2);
    border-color: rgba(124, 58, 237, 0.3);
  }

  .book-section img {
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    margin: 0;
    transition: all 0.3s ease;
    flex-shrink: 0;
    width: 200px;
    height: auto;
  }

  .book-section:hover img {
    transform: scale(1.05) rotate(-2deg);
    box-shadow: 0 15px 35px rgba(124, 58, 237, 0.3);
  }

  .book-cover-link {
    display: block;
    text-decoration: none;
  }

  .work-title-link {
    color: var(--text-main);
    text-decoration: none;
    background: linear-gradient(to right, var(--primary-color), #c084fc);
    background-size: 0% 2px;
    background-repeat: no-repeat;
    background-position: left bottom;
    transition: background-size 0.3s ease, color 0.3s ease;
  }

  .work-title-link:hover {
    background-size: 100% 2px;
    color: var(--primary-color);
  }

  .button-group {
    display: flex;
    gap: 1em;
    margin-top: 1em;
    flex-wrap: wrap;
  }

  .buy-button,
  .learn-more-button {
    display: inline-block;
    padding: 1em 2em;
    text-decoration: none;
    border-radius: 12px;
    font-weight: bold;
    box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    font-family: var(--font-family-sans);
  }

  .buy-button {
    background: var(--primary-gradient);
    color: white;
  }

  .learn-more-button {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    box-shadow: 0 6px 20px rgba(79, 172, 254, 0.3);
  }

  .buy-button::before,
  .learn-more-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
  }

  .buy-button:hover::before {
    width: 300px;
    height: 300px;
  }

  .buy-button:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 10px 30px rgba(124, 58, 237, 0.5);
  }

  .learn-more-button:hover::before {
    width: 300px;
    height: 300px;
  }

  .learn-more-button:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 10px 30px rgba(79, 172, 254, 0.5);
  }

  .testimonials-section {
    margin-top: 4em;
    padding: 3em 2em;
    display: flex;
    flex-direction: column;
    gap: 2em;
    background: rgba(249, 250, 251, 0.8);
    border-radius: 16px;
    border-top: 3px solid var(--primary-color, #548e9b);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
  }

  .testimonial {
    background: linear-gradient(135deg, rgba(167, 139, 250, 0.08) 0%, rgba(249, 168, 212, 0.08) 100%);
    padding: 2em;
    border-radius: 16px;
    border-left: 5px solid transparent;
    border-image: var(--magic-gradient) 1;
    margin: 0;
    box-shadow: 0 8px 25px rgba(124, 58, 237, 0.1);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
  }

  .testimonial::before {
    content: '"';
    position: absolute;
    top: -10px;
    left: 20px;
    font-size: 6em;
    color: rgba(124, 58, 237, 0.1);
    font-family: Georgia, serif;
    line-height: 1;
  }

  .testimonial:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2);
  }

  .testimonial p {
    font-size: 0.95em;
    line-height: 1.7;
    color: #333;
    font-style: italic;
    margin: 0 0 1em 0;
  }

  .testimonial cite {
    font-size: 0.95em;
    color: #666;
    font-style: normal;
    font-weight: 600;
    display: block;
  }

  @media (max-width: 1020px) {
    .container-new {
      padding: 1.5em;
      max-width: 100%;
    }

    .work-image {
      float: none;
      margin: 0 auto 2em;
    }

    .book-section {
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1.5em;
      margin: 2em 0;
    }

    .book-section img {
      width: 100%;
      max-width: 200px;
      margin: 0 0 1.5em 0;
    }

    .testimonials-section {
      padding: 2em 1.5em;
      margin-top: 3em;
    }

    .testimonial {
      padding: 1.5em;
    }

    .testimonial::before {
      font-size: 4em;
    }
  }

  @media (max-width: 600px) {
    .container-new {
      padding: 1em;
    }

    .book-section {
      padding: 1em;
      gap: 1em;
    }

    .button-group {
      flex-direction: column;
    }

    .buy-button,
    .learn-more-button {
      width: 100%;
      text-align: center;
    }

    .testimonials-section {
      padding: 1.5em 1em;
    }
  }
</style>
