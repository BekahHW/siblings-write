---

import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostHog from '../components/posthog.astro';

export interface Props {
  title: string;
  description: string;
  permalink: string;
  current?: string;
  hideNewsletterFooter?: boolean;
}
const { title, description, permalink, current, hideNewsletterFooter = false } = Astro.props;
---
<html lang="en">
<head>
  <BaseHead title={title} description={description} permalink={permalink} />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script is:inline type="text/javascript" id="posthog-js">
    !(function(t, e) {
      var o, n, p, r;
      e.__SV ||
        ((window.posthog = e),
        (e._i = []),
        (e.init = function(i, s, a) {
          function g(t, e) {
            var o = e.split('.');
            2 == o.length && ((t = t[o[0]]), (e = o[1])),
              (t[e] = function() {
                t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
              });
          }
          ((p = t.createElement('script')).type = 'text/javascript'),
            (p.crossOrigin = 'anonymous'),
            (p.async = true),
            (p.src = s.api_host + '/static/array.js'),
            (r = t.getElementsByTagName('script')[0]).parentNode.insertBefore(p, r);
          var u = e;
          void 0 !== a ? (u = e[a] = []) : (a = 'posthog');
          u.people = u.people || [];
          u.toString = function(t) {
            var e = 'posthog';
            return 'posthog' !== a && (e += '.' + a), t || (e += ' (stub)'), e;
          };
          u.people.toString = function() {
            return u.toString(1) + '.people (stub)';
          };
          o =
            'capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId'.split(
              ' '
            );
          for (n = 0; n < o.length; n++) g(u, o[n]);
          e._i.push([i, s, a]);
        }),
        (e.__SV = 1));
    })(document, window.posthog || []);
    posthog.init('phc_JS6XFROuNbhJtVCEdTSYk6gl5ArRrTNMpCcguAXlSPs', { api_host: 'https://us.i.posthog.com', defaults: '2025-05-24' });
    if (posthog.startSessionRecording) {
      posthog.startSessionRecording();
    }
  </script>
</head>
<body>
  <!-- Reading Progress Bar -->
  <div id="reading-progress-bar" class="progress-bar-container">
    <div class="progress-bar-fill"></div>
    <div class="progress-sparkle">âœ¨</div>
  </div>

  <div class="layout">
    <Header current={current} />

    <main>
      <slot />
    </main>

    <Footer hideNewsletter={hideNewsletterFooter} />
  </div>

  <script is:inline>
    // Reading Progress Bar with Sparkle
    function updateProgressBar() {
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight - windowHeight;
      const scrolled = window.scrollY;
      const progress = (scrolled / documentHeight) * 100;

      const progressBar = document.querySelector('.progress-bar-fill');
      const sparkle = document.querySelector('.progress-sparkle');

      if (progressBar && sparkle) {
        progressBar.style.width = progress + '%';
        sparkle.style.left = progress + '%';

        // Update gradient darkness around sparkle
        const gradientPos = progress;
        progressBar.style.background = `linear-gradient(90deg,
          rgba(102, 126, 234, 0.3) 0%,
          rgba(102, 126, 234, 0.6) ${Math.max(0, gradientPos - 10)}%,
          rgba(102, 126, 234, 1) ${gradientPos}%,
          rgba(102, 126, 234, 0.6) ${Math.min(100, gradientPos + 10)}%,
          rgba(102, 126, 234, 0.3) 100%
        )`;
      }
    }

    // Update on scroll
    window.addEventListener('scroll', updateProgressBar, { passive: true });

    // Update on load
    window.addEventListener('load', updateProgressBar);

    // Update on resize
    window.addEventListener('resize', updateProgressBar, { passive: true });
  </script>
</body>
</html>

<style>
  /* Reading Progress Bar */
  .progress-bar-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: rgba(0, 0, 0, 0.05);
    z-index: 10000;
    overflow: visible;
  }

  .progress-bar-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,
      rgba(102, 126, 234, 0.3) 0%,
      rgba(102, 126, 234, 1) 50%,
      rgba(102, 126, 234, 0.3) 100%
    );
    transition: width 0.1s ease-out;
    position: relative;
    box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
  }

  .progress-sparkle {
    position: absolute;
    top: -8px;
    left: 0;
    transform: translateX(-50%);
    font-size: 1.2em;
    pointer-events: none;
    filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.8));
    animation: sparkle-bounce 1s ease-in-out infinite;
    transition: left 0.1s ease-out;
  }

  @keyframes sparkle-bounce {
    0%, 100% {
      transform: translateX(-50%) translateY(0) rotate(0deg);
    }
    50% {
      transform: translateX(-50%) translateY(-3px) rotate(10deg);
    }
  }

  .layout {
    display: flex;
    flex-direction: column;
    min-height: 100%;
    min-height: 100vh;
  }

  main {
    flex: 1;
    position: relative;
    margin: 0 auto;
    max-width: 1400px;
    padding: 1em 2em;
    box-sizing: border-box;
    width: 100%;
    display: flex;
    flex-direction: column;
  }

  @media screen and (max-width: 520px) {
    main {
      padding: 1em;
    }

    .progress-sparkle {
      font-size: 1em;
      top: -6px;
    }
  }
</style>
