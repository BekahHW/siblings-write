name: Test PostHog CLI Integration

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
        contents: read
        issues: write

    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: "20"

    - name: Install Continue CLI
      run: npm install -g @continuedev/cli

    - name: Test Model Information
      env:
        CONTINUE_API_KEY: ${{ secrets.CONTINUE_API_KEY }}
      run: |
        echo "🤖 Testing model information retrieval..."
        
        # Test /model command
        timeout 30s cn --config continuedev/awesome-models-posthog-gh -p "/model" 2>&1 | tee model_test.log
        
        # Alternative: Ask directly about the model
        timeout 30s cn --config continuedev/awesome-models-posthog-gh -p "What model and provider are you currently using? Please respond with just the model name." 2>&1 | tee model_direct.log

    - name: Test PostHog Connection Quick
      env:
        CONTINUE_API_KEY: ${{ secrets.CONTINUE_API_KEY }}
      run: |
        echo "📊 Quick PostHog connection test..."
        
        timeout 60s cn --config continuedev/awesome-models-posthog-gh -p "Do you have access to PostHog? List any PostHog-related tools or MCP functions available." 2>&1 | tee posthog_quick.log

    - name: Test GitHub CLI Integration
      env:
        CONTINUE_API_KEY: ${{ secrets.CONTINUE_API_KEY }}
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "🐙 Testing GitHub CLI integration..."
        
        timeout 45s cn --config continuedev/awesome-models-posthog-gh -p "Execute this command and show me the result: gh repo view $GITHUB_REPOSITORY --json name,owner" 2>&1 | tee github_test.log

    - name: Results
      if: always()
      run: |
        echo "📊 TEST RESULTS:"
        echo "================"
        
        echo "Model Test (/model):"
        cat model_test.log 2>/dev/null || echo "No output"
        echo ""
        
        echo "Model Direct Test:"
        cat model_direct.log 2>/dev/null || echo "No output"
        echo ""
        
        echo "PostHog Test:"
        cat posthog_quick.log 2>/dev/null || echo "No output"
        echo ""
        
        echo "GitHub Test:"
        cat github_test.log 2>/dev/null || echo "No output"