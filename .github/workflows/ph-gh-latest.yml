name: Debug Agent Loading in Headless Mode

on:
  workflow_dispatch:

jobs:
  debug-agent:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "22"

      - name: Install Continue CLI with Debug Output
        run: |
          echo "📦 Installing Continue CLI..."
          npm install @continuedev/cli
          echo "✅ Continue CLI version: $(npx @continuedev/cli --version)"
          
          # Check if the package has debug capabilities
          echo ""
          echo "Checking for debug environment variables:"
          npx @continuedev/cli --help 2>&1 | grep -i "debug\|verbose" || echo "No debug flags found in help"

      - name: Test Agent Loading with Verbose/Debug Mode
        env:
          CONTINUE_API_KEY: ${{ secrets.CONTINUE_API_KEY }}
          # Try various debug environment variables
          DEBUG: "*"
          NODE_ENV: "development"
          CONTINUE_DEBUG: "true"
          VERBOSE: "true"
        run: |
          echo "🔍 TESTING AGENT LOADING WITH DEBUG OUTPUT"
          echo "==========================================="
          
          echo "1. Test with verbose flag if available:"
          echo "---------------------------------------"
          npx @continuedev/cli --verbose --config continuedev/awesome-models-posthog-gh -p "What is your agent name and version?" 2>&1 | tee verbose_test.log || echo "Verbose flag may not exist"
          
          echo ""
          echo "2. Test with debug environment:"
          echo "-------------------------------"
          DEBUG="*" npx @continuedev/cli --config continuedev/awesome-models-posthog-gh -p "What is your agent configuration name?" 2>&1 | tee debug_test.log
          
          echo ""
          echo "3. Check stderr for hidden debug output:"
          echo "----------------------------------------"
          npx @continuedev/cli --config continuedev/awesome-models-posthog-gh -p "List your configuration" 2>&1 | tee full_output.log

      - name: Test Different Agent Slug Formats
        env:
          CONTINUE_API_KEY: ${{ secrets.CONTINUE_API_KEY }}
        run: |
          echo "🔄 TESTING DIFFERENT command"
          echo "===================================="
          
          echo "from the cli:"
          npx @continuedev/cli --config continuedev/awesome-models-posthog-gh -p "What agent are you?" 2>&1 | tee format1.log
          npx @continuedev/cli --config continuedev/awesome-models-posthog-gh -p "Using the PostHog MCP,
           analyze my website's user data and identify the top 3 UX issues that need attention.  Focus on session recordings, user behavior patterns, and pain points." 2>&1 | tee format2.log
          
        